{% extends "base.html" %}

{% block title %}My Timetable - Student Portal{% endblock %}

{% block content %}

<div class="card">
    <h2>ğŸ“… My Weekly Timetable</h2>
    <p>View your class schedule for the current semester</p>
</div>

<div class="card">
    {% if timetable_data %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden;">
            <thead>
                <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                    <th style="padding: 15px; text-align: center; font-weight: 600; width: 120px;">Time/Day</th>
                    {% for day in days %}
                    <th style="padding: 15px; text-align: center; font-weight: 600;">{{ day }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for start_time, end_time, display_time in time_slots %}
                <tr>
                    <td style="padding: 12px 15px; text-align: center; font-weight: 600; background: #f8f9fa; border-bottom: 1px solid #dee2e6;">
                        {{ display_time }}
                    </td>
                    
                    {% for day in days %}
                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6; vertical-align: top; min-width: 180px; height: 100px;">
                        {% for entry in timetable_data %}
                            {% if entry.day_of_week == day and entry.start_time_str == start_time %}
                            <div class="timetable-entry" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 10px; border-radius: 8px; margin: 2px; font-size: 0.85rem; height: 90px; display: flex; flex-direction: column; justify-content: center;">
                                <div style="font-weight: bold; margin-bottom: 4px;">{{ entry.course_code }}</div>
                                <div style="font-size: 0.75rem; margin-bottom: 2px;">{{ entry.course_name }}</div>
                                <div style="font-size: 0.7rem; opacity: 0.9;">
                                    ğŸ  {{ entry.room_number }}<br>
                                    ğŸ‘¨â€ğŸ« {{ entry.instructor }}
                                </div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Course Summary -->
    <div style="margin-top: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
            <h4 style="margin-bottom: 15px; color: #2d3748;">ğŸ“š Registered Courses This Week</h4>
            <div style="max-height: 200px; overflow-y: auto;">
                {% set unique_courses = [] %}
                {% for entry in timetable_data %}
                    {% if entry.course_code not in unique_courses %}
                        {% set _ = unique_courses.append(entry.course_code) %}
                        <div style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <strong>{{ entry.course_code }}</strong> - {{ entry.course_name }}<br>
                            <small style="color: #718096;">{{ entry.instructor }}</small>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #48bb78;">
            <h4 style="margin-bottom: 15px; color: #2d3748;">â„¹ Timetable Summary</h4>
            <div style="line-height: 1.6;">
                <p><strong>Total Classes This Week:</strong> {{ timetable_data|length }}</p>
                <p><strong>Unique Courses:</strong> {{ unique_courses|length }}</p>
                <p><strong>Current Semester:</strong> Fall 2024</p>
                <p><strong>Last Updated:</strong> Today</p>
            </div>
        </div>
    </div>
    
    {% else %}
    <div style="text-align: center; padding: 60px 20px; color: #718096;">
        <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“…</div>
        <h3>No Timetable Available</h3>
        <p>Your timetable hasn't been set up yet or you haven't been assigned to any classes.</p>
        <div style="margin-top: 25px;">
            <a href="{{ url_for('courses') }}" class="btn" style="margin-right: 10px;">Browse Courses</a>
            <a href="{{ url_for('help_desk') }}" class="btn secondary">Contact Support</a>
        </div>
    </div>
    {% endif %}
</div>

<style>
.timetable-entry {
    transition: all 0.3s ease;
    cursor: pointer;
}

.timetable-entry:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

@media (max-width: 768px) {
    table {
        font-size: 0.75rem;
    }
    
    .timetable-entry {
        font-size: 0.7rem !important;
        padding: 6px !important;
        height: 70px !important;
    }
}
</style>
{% endblock %}
