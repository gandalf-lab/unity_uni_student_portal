{% extends "base.html" %}

{% block title %}Register - Student Portal{% endblock %}

{% block content %}
<div style="max-width: 500px; margin: 0 auto;">
    <div class="card">
        <div style="text-align: center; margin-bottom: 30px;">
            <div style="font-size: 4rem; margin-bottom: 10px;">ðŸš€</div>
            <h2>Create Account</h2>
            <p style="color: #718096;">Join our student community</p>
        </div>

        <form method="POST" id="registrationForm">
            <div class="form-group">
                <label>ðŸŽ“ University ID</label>
                <input type="text" name="university_id" placeholder="Enter your University ID (e.g., U2024001)" required>
                <small style="color: #718096; display: block; margin-top: 5px;">
                    Use the ID provided by the university during admission
                </small>
            </div>
            
            <div class="form-group">
                <label>ðŸŽ“ Faculty</label>
                <select name="faculty" id="facultySelect" required onchange="updateMajors()">
                    <option value="">Select Faculty</option>
                    <option value="FCIT">Faculty of Computer & Information Technology</option>
                    <option value="FBBA">Faculty of Business & Business Administration</option>
                    <option value="FENG">Faculty of Engineering</option>
                    <option value="FMED">Faculty of Health science</option>
                    <option value="FSCI">Faculty of Social Science</option>
                    <option value="FART">Faculty of Arts</option>
                    <option value="FLAW">Faculty of Law</option>
                    <option value="FEDU">Faculty of Education</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ðŸŽ¯ Major/Program</label>
                <select name="major" id="majorSelect" required disabled>
                    <option value="">First select your Faculty</option>
                </select>
            </div>

            <div class="form-group">
                <label>ðŸ‘¤ First Name</label>
                <input type="text" name="first_name" placeholder="Enter your first name" required>
            </div>
            
            <div class="form-group">
                <label>ðŸ‘¤ Last Name</label>
                <input type="text" name="last_name" placeholder="Enter your last name" required>
            </div>
            
            <div class="form-group">
                <label>ðŸ“§ Email Address</label>
                <input type="email" name="email" placeholder="Enter your email" required>
            </div>
            
            <div class="form-group">
                <label>ðŸ“ž Phone Number</label>
                <input type="tel" name="phone_number" placeholder="Enter your phone number" required>
                <small style="color: #718096; display: block; margin-top: 5px;">
                    Format: +1234567890 or 1234567890
                </small>
            </div>
            
            <div class="form-group">
                <label>ðŸ”’ Password</label>
                <input type="password" name="password" placeholder="Create a password (min 6 characters)" required>
            </div>
            
            <div class="form-group">
                <label>âœ… Confirm Password</label>
                <input type="password" name="confirm_password" placeholder="Confirm your password" required>
            </div>
            
            <div class="form-group">
                <label>ðŸ“… Enrollment Year</label>
                <input type="number" name="enrollment_year" placeholder="2024" min="2000" max="2030" required>
            </div>
            
            <button type="submit" class="btn" style="width: 100%;">Create Account</button>
        </form>
        
        <div style="text-align: center; margin-top: 25px; padding-top: 25px; border-top: 1px solid #e2e8f0;">
            <p style="color: #718096;">Already have an account? 
                <a href="{{ url_for('login') }}" style="color: #667eea; text-decoration: none; font-weight: bold;">
                    Sign In
                </a>
            </p>
        </div>
    </div>
</div>

<script>
async function updateMajors() {
    const facultySelect = document.getElementById('facultySelect');
    const majorSelect = document.getElementById('majorSelect');
    const selectedFaculty = facultySelect.value;
    
    if (!selectedFaculty) {
        majorSelect.innerHTML = '<option value="">First select your Faculty</option>';
        majorSelect.disabled = true;
        return;
    }
    
    try {
        // FIXED: Use backticks for template literal
        const response = await fetch(`/get_majors/${selectedFaculty}`);
        const majors = await response.json();
        
        majorSelect.innerHTML = '<option value="">Select Your Major</option>';
        majors.forEach(major => {
            const option = document.createElement('option');
            option.value = major;
            option.textContent = major;
            majorSelect.appendChild(option);
        });
        
        majorSelect.disabled = false;
    } catch (error) {
        console.error('Error fetching majors:', error);
        majorSelect.innerHTML = '<option value="">Error loading majors</option>';
    }
}

// Phone number validation
document.getElementById('registrationForm').addEventListener('submit', function(e) {
    const phoneInput = document.querySelector('input[name="phone_number"]');
    const phone = phoneInput.value.trim();
    const phoneRegex = /^\+?1?\d{9,15}$/;
    
    if (!phoneRegex.test(phone)) {
        e.preventDefault();
        alert('Please enter a valid phone number (9-15 digits, optional + prefix)');
        phoneInput.focus();
    }
});
</script>
{% endblock %}

