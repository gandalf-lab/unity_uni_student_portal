{% extends "base.html" %}

{% block title %}Dashboard - Student Portal{% endblock %}

{% block content %}

<div class="welcome card">
    <h2>Welcome, {{ student_name }}!</h2>
    <p><strong>University ID:</strong> {{ session.get('student_university_id', 'N/A') }}</p>
    <p>Manage your academic journey with our comprehensive student portal.</p>
</div>

<div class="dashboard-cards">
    <div class="dashboard-card">
        <h3>ğŸ‘¤ My Profile</h3>
        <p>View your personal information</p>
        <a href="{{ url_for('profile') }}" class="btn">View Profile</a>
    </div>
    
    <div class="dashboard-card">
        <h3>ğŸ“š Course Registration</h3>
        <p>Browse and register for courses</p>
        <a href="{{ url_for('courses') }}" class="btn">Register Courses</a>
    </div>
    
    <div class="dashboard-card">
        <h3>ğŸ“ Academic Grades</h3>
        <p>Check your grades and academic history</p>
        <a href="{{ url_for('grades') }}" class="btn">View Grades</a>
    </div>
    
    <div class="dashboard-card">
        <h3>ğŸ“… My Timetable</h3>
        <p>View your weekly class schedule</p>
        <a href="{{ url_for('timetable') }}" class="btn">View Timetable</a>
    </div>
</div>

<!-- Today's Classes Section -->
<div class="card">
    <h3>ğŸ“… Today's Classes</h3>
    {% set days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
    {% set today_name = days[now().weekday()] if now else 'Monday' %}
    
    <p><strong>Today is {{ today_name }}</strong></p>
    
    {% if timetable_data %}
        {% set todays_classes = [] %}
        {% for entry in timetable_data %}
            {% if entry.day_of_week == today_name %}
                {% set _ = todays_classes.append(entry) %}
            {% endif %}
        {% endfor %}
        
        {% if todays_classes %}
            <div style="margin-top: 15px;">
                {% for entry in todays_classes %}
                <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea; transition: all 0.3s ease;">
                    <div style="display: flex; justify-content: between; align-items: start;">
                        <div style="flex: 1;">
                            <strong style="color: #2d3748; font-size: 1.1rem;">{{ entry.course_code }} - {{ entry.course_name }}</strong>
                            <div style="margin-top: 8px; color: #4a5568;">
                                <span style="display: inline-block; margin-right: 15px;">
                                    â° {{ entry.start_time.strftime('%I:%M %p') }} - {{ entry.end_time.strftime('%I:%M %p') }}
                                </span>
                                <span style="display: inline-block; margin-right: 15px;">
                                    ğŸ  {{ entry.room_number }}
                                </span>
                                <span style="display: inline-block;">
                                    ğŸ‘¨â€ğŸ« {{ entry.instructor }}
                                </span>
                            </div>
                        </div>
                        <div style="background: #667eea; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;">
                            ACTIVE
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 30px; color: #718096;">
                <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ‰</div>
                <h4>No classes scheduled for today!</h4>
                <p>Enjoy your free time or use it for self-study.</p>
            </div>
        {% endif %}
    {% else %}
        <div style="text-align: center; padding: 30px; color: #718096;">
            <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ“…</div>
            <h4>No Timetable Available</h4>
            <p>Your timetable hasn't been set up yet.</p>
            <a href="{{ url_for('courses') }}" class="btn" style="margin-top: 15px;">Register for Courses</a>
        </div>
    {% endif %}
    
    <div style="text-align: center; margin-top: 20px;">
        <a href="{{ url_for('timetable') }}" class="btn">View Weekly Timetable</a>
    </div>
</div>

<!-- Quick Stats Section -->
<div class="card">
    <h3>ğŸ“Š Quick Stats</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 15px;">
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 10px;">
            <div style="font-size: 2rem; font-weight: bold;">{{ timetable_data|length if timetable_data else 0 }}</div>
            <div>Weekly Classes</div>
        </div>
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f093fb, #f5576c); color: white; border-radius: 10px;">
            <div style="font-size: 2rem; font-weight: bold;">{{ todays_classes|length if todays_classes else 0 }}</div>
            <div>Today's Classes</div>
        </div>
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; border-radius: 10px;">
            <div style="font-size: 2rem; font-weight: bold;">
                {% if timetable_data %}
                    {% set unique_courses = [] %}
                    {% for entry in timetable_data %}
                        {% if entry.course_code not in unique_courses %}
                            {% set _ = unique_courses.append(entry.course_code) %}
                        {% endif %}
                    {% endfor %}
                    {{ unique_courses|length }}
                {% else %}
                    0
                {% endif %}
            </div>
            <div>Active Courses</div>
        </div>
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; border-radius: 10px;">
            <div style="font-size: 2rem; font-weight: bold;">{{ session.get('student_university_id', 'N/A')|length }}</div>
            <div>Student ID</div>
        </div>
    </div>
</div>

<!-- Recent Announcements Section -->
<div class="card">
    <h3>ğŸ“¢ Recent Announcements</h3>
    {% if announcements %}
        <div class="dashboard-announcements">
            {% for announcement in announcements %}
            <div class="dashboard-announcement {% if announcement.is_important %}dashboard-important{% endif %}">
                <div style="display: flex; align-items: start; gap: 15px;">
                    {% if announcement.is_important %}
                    <div style="background: #e53e3e; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold;">
                        IMPORTANT
                    </div>
                    {% endif %}
                    <div style="flex: 1;">
                        <h4 style="margin: 0 0 8px 0; color: #2d3748;">{{ announcement.title }}</h4>
                        <p style="margin: 0 0 10px 0; color: #4a5568;">{{ announcement.content[:100] }}{% if announcement.content|length > 100 %}...{% endif %}</p>
                        <div class="announcement-meta">
                            <span style="color: #718096; font-size: 0.9rem;">{{ announcement.created_at.strftime('%b %d, %Y') }}</span>
                            <span style="color: #718096; font-size: 0.9rem;">By: {{ announcement.author }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <a href="{{ url_for('announcements') }}" class="btn">View All Announcements</a>
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px; color: #718096;">
            <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ“£</div>
            <h4>No Recent Announcements</h4>
            <p>Check back later for updates from the university.</p>
        </div>
    {% endif %}
</div>

<!-- Upcoming Deadlines Section -->
<div class="card">
    <h3>â° Important Dates</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
        <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #e53e3e;">
            <strong style="color: #2d3748;">Course Registration</strong>
            <p style="margin: 8px 0 0 0; color: #718096;">Ends: September 15, 2024</p>
        </div>
        <div style="background: #f0fff4; padding: 15px; border-radius: 8px; border-left: 4px solid #38a169;">
            <strong style="color: #2d3748;">Midterm Exams</strong>
            <p style="margin: 8px 0 0 0; color: #718096;">October 10-20, 2024</p>
        </div>
        <div style="background: #faf5ff; padding: 15px; border-radius: 8px; border-left: 4px solid #805ad5;">
            <strong style="color: #2d3748;">Final Exams</strong>
            <p style="margin: 8px 0 0 0; color: #718096;">December 15-22, 2024</p>
        </div>
    </div>
</div>

<style>
.welcome.card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
}

.welcome.card h2 {
    color: white;
    margin-bottom: 15px;
}

.welcome.card p {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 10px;
}

.dashboard-announcement {
    padding: 15px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.dashboard-announcement:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.dashboard-important {
    border-left: 4px solid #e53e3e;
    background: #fff5f5;
}

.announcement-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: #718096;
    margin-top: 10px;
}

@media (max-width: 768px) {
    .dashboard-cards {
        grid-template-columns: 1fr;
    }
    
    .announcement-meta {
        flex-direction: column;
        gap: 5px;
    }
}
</style>

{% endblock %}
